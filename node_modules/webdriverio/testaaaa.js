var webdriverio = require('webdriverio'),
    matrix;

describe('multibrowser functional test', function() {

    before(function() {
        /**
         * initiate browser matrix you want to work with
         */
        matrix = webdriverio.multiremote({
            'myChromeBrowser': {
                desiredCapabilities: {
                    browserName: 'chrome'
                }
            },
            'myFirefoxBrowser': {
                desiredCapabilities: {
                    browserName: 'firefox'
                }
            }
        });
    })

    it('check if chat message arrives', function(done) {

        var chrome = matrix.select('myChromeBrowser'),
            firefox = matrix.select('myFirefoxBrowser');

        /**
         * this part gets executed by all instances in parallel
         */
        matrix
            .init()
            .url('http://site.com/login')
            .setInput('#username','user123')
            .setInput('#password','*******')
            .submitForm('#login');

        /**
         * this part gets only execute by specific instance
         */
        chrome
            .setValue('#messageBox', 'Hello I\'m a Chrome browser')
            .click('=Send');

        firefox
            .getValue('#chat', function(err, text) {
                text.should.be.equal('Hello I\'m a Chrome browser');
            });
            .setValue('#messageBox', 'Hello Chrome! Here comes the Firefox')
            .click('=send');

        /**
         * sync up all browser
         */
        matrix.call(done)

    });

});